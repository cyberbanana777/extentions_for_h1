# Описание
В данном репозитории лежат пакеты для ROS2 предназначенные для расширения функционала робота Unitree H1.
# Перед запуском нод
Все действия с роботом, реализованные с помощью данных пакетов. **не требуют перевода его в режим разработчика**. 
Но для корректной работы нод, управляющих движением рук, **необходимо перевести робота в режим балансирования**. 
Сделать это можно как с пульта (см. в другой [методичке]() - позже появится ссылка ) или через клиент, последовательно выполнив действия:
1. `damp`
2. `stand_up`
3. `start`
## **Важно!!!** 
Первые 2 пункта робот должен выполнять в воздухе (в подвешенном состоянии) - чтобы ничего не мешало его движениям. Перед выполнением последнего пункта необходимо опустить робота, чтобы его ноги сопрbкоснулись с полом и встали на него полностью. Последняя функция активирует режим балансирования - робот будет перебирать ногами, до тех пор пока не установит равновесие.
# Содержание репозитория:
## Краткое описание
 - Пакет `button_server` - поднимает сайт и получает информацию с него
 - Пакет `completed_scripts` - laucn-файлы, которые запускают определённые конфигурации нод
 - Пакет `cyclonedds` - для нормального обмена сообщениями в системе H1
 - Пакет `high_level_control` - управление high-level командами для перевода робота в различные режимы 
 - Пакет `low_level_control` - задание кастомного положения робота через low-level команды (посылками наборов координат)
 - Пакет `macros_writer` - позволяет записать макрос для движений робота с помощью копирующего устройства (от Фёдора)
 - Пакет `rmw_cyclonedds` - для нормального обмена сообщениями в системе H1
 - Пакет `udp_listener_and_converter` - получает координаты с копирующего устройства и переводит в координаты H1
 - Пакет `unitree` - для нормального обмена сообщениями в системе H1
## Подробное описание
### Пакет button_server
Пакет предназначен для управления кнопками робота Unitree H1.
Скрипты, реализованные в этом пакете:
#### Запуск сервера
Поднимает сайт с кнопками, которые можно нажимать
```
ros2 run button_server server_stand_up
```
#### Запуск слушателя сайта
Запускает ноду, которая обращается по API к серверу и получает информацию о состоянии кнопок. Нода публикует информацию об активной кнопке (или её отсутствии) в топике `/button_status`
```
ros2 run button_server hear_server
``` 

### Пакет completed_scripts
Пакет содержит launch-файлы, позволяющие запускать несколько нод одновременнно по заготовенным сценариям:
#### Сценарии
##### Повторение положения рук копирующего устройства роботом H1 
```
ros2 launch completed_scripts Fedor_teleop.launch.py
```
Руки H1 будут принимать такое же положение, как и копирующее устройство от Фёдора. (Предварительно на машине, к которой подключено копирующее устройство, должна быть запущена unity-программа-визуализатор (в программе необходимо нажать кнопку "Out control" и ползунок ниже установлен на 0.100, не активируя галочку возле ползунка))
Запускает следующие ноды:
- `upd_listener_and_converter`
- `low_level_control`

##### Управление расширенным функционалом Unitree_H1
```
ros2 launch completed_scripts H1_control_by_buttons.launch.py
```
Запускает сценарий управления роботом, с помощью кастомных заранее записанных функций, через web-интерфейс.
Ноды, которые запускаются в скрипте:
    1. `server_stand_up`
    2. `server_hear`
    3. `low_level_control`
    4. `---`




# НЕДОДЕЛАНО
## Пакет high_level_control
Пакет предназначен для управления роботом Unitree H1. Модуль клиента необходимо **запускать вручную**, т.к. он требует постоянного ввода.
Скрипты, реализованные в этом пакете:
- `ros2 run high_level_control high_level_control` - запускает клиента, который позволяет отправлять high-level команды для управления роботом Unitree H1.


# Запуск
Использование пакетов возможно несколькими способами:
 - **Запуск launch-файлов.** Этот метод позволит запустить несколько нод одновременно из одного терминала. Подходит для работы уде отлаженной системы.
 - **Запуск отдельных нод.** Этот метод хорош для использования конкретных нод или в случает отладки
